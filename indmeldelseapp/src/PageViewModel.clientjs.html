<script type="text/javascript"> 
/// <reference path="../../index.d.ts" />
var IndmeldelseApp;
(function (IndmeldelseApp) {
    var PageViewModel = (function () {
        /**
         *
         */
        function PageViewModel(isCallingServer, indmeldelser, logMessages) {
            if (isCallingServer === void 0) { isCallingServer = ko.observable(false); }
            if (indmeldelser === void 0) { indmeldelser = ko.observableArray([]); }
            if (logMessages === void 0) { logMessages = ko.observableArray(["VÃ¦lg en handling"]); }
            this.isCallingServer = isCallingServer;
            this.indmeldelser = indmeldelser;
            this.logMessages = logMessages;
            this.loadIndmeldelser();
        }
        PageViewModel.prototype.indmeld = function (email) {
            var _this = this;
            this.isCallingServer(true);
            callGoogleApi(function (result) {
                return _this.feedBack(email, result);
            }, this.defaultErrorHandler)
                .indmeld(email);
        };
        PageViewModel.prototype.feedBack = function (email, result) {
            this.isCallingServer(false);
            if (result.success) {
                $.each(this.indmeldelser().filter(function (item) { return item.email === email; }), function (index, item) {
                    item.status(result.newStatus);
                });
            }
            this.logMessages.push(result.message);
        };
        PageViewModel.prototype.sendVelkomstMail = function (email) {
            var _this = this;
            this.isCallingServer(true);
            callGoogleApi(function (result) { _this.feedBack(email, result); }, this.defaultErrorHandler)
                .sendVelkomstMail(email);
        };
        PageViewModel.prototype.afvis = function (email) {
            var _this = this;
            this.isCallingServer(true);
            callGoogleApi(function (result) { _this.feedBack(email, result); }, this.defaultErrorHandler)
                .afvis(email);
        };
        PageViewModel.prototype.defaultErrorHandler = function (message) {
            this.isCallingServer(false);
            console.log(message);
            alert(message);
        };
        PageViewModel.prototype.sendInviteTestMail = function () {
            var _this = this;
            callGoogleApi(function () { _this.logMessages.push("sendt test mail"); }, this.defaultErrorHandler).sendInviteTestMail();
        };
        PageViewModel.prototype.sendConfirmationTestMail = function () {
            var _this = this;
            callGoogleApi(function () { _this.logMessages.push("sendt test mail"); }, this.defaultErrorHandler).sendConfirmationTestMail();
        };
        PageViewModel.prototype.loadIndmeldelser = function () {
            var _this = this;
            callGoogleApi(function (result) {
                _this.indmeldelser(result.map(function (item) {
                    item.status = ko.observable(item.status);
                    return item;
                }));
            }, function (e) { return _this.defaultErrorHandler(e); }).getUbehandledeIndmeldelser();
        };
        return PageViewModel;
    }());
    IndmeldelseApp.PageViewModel = PageViewModel;
})(IndmeldelseApp || (IndmeldelseApp = {}));

</script>