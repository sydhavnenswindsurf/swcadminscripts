<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
       <script src="https://code.jquery.com/jquery-2.2.4.min.js"
			  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
			  crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
 
  </head>
  <body>
  <h1>Masseudmeldelse af medlemmer</h1>
  Denne funktion hjælper med automatisk at udmelde flere medlemmer af gangen. Ved kontingentsvar/rykkere er der ofter en del der skriver tilbage, at de ikke ønsker at være medlem.
  For at lette det arbejde, kan man vælge at flytte de mails ind i folderen <a target="_blank" href="https://mail.google.com/mail/u/0/#label/SWC+Admin%2FUdmeldelser"><?=data.mailLabel?></a> i klubbens gmail.
  Denne side læser så email adresserne derfra, og lister dem her. Man kan så klikke på knappen nedenfor og herved sættes udmeldte flaget til, og mailen flytte til en underfolder <a href="https://mail.google.com/mail/u/0/#label/SWC+Admin%2FUdmeldelser%2FProcesseret" target="_blank">/processeret</a>.
  
  <p>Bemærk at du også kan udmelde medlemmer manuelt her: <a href="https://sites.google.com/site/swcmedlemoghylder/medlemmer/indmeldte" target="_blank">medlemmer</a></p>
  
  <section id="bulkudmeld-funktion">
   <? if(!data.mailLabelExists) {?>
    Kunne ikke lede efter udmeldelser, fordi den konfigurede mail label: <?=data.mailLabel?> findes ikke.
  <? } else{?>
  
      <? if(data.listOfMails.length==0) {?>
          Der ikke er fundet nogen mails til behandling i folderen <strong> <?=data.mailLabel?> </strong>. Flyt udmeldelses mails til den folder, og reload siden for at foretage masseudmeldelse.
      <? } else{?>
      
          <div class="waiter" data-bind="visible:isLoading"></div><span data-bind="text:currentProcessMessage"></span>
          <section id="logmessages">
             <div class="succes" data-bind="foreach:udmeldtMessages">
             <div data-bind="text:$data"></div>
              </div>
             <div class="error" data-bind="foreach:notFoundMessages">
              <div data-bind="text:$data"></div>
              
             </div>
             <div data-bind="visible:notFoundMessages().length>0">
                Der kan være flere årsager til at visse medlemmer ikke kan udmeldes, måske er de registreret med en anden mailadresse.
                Eller også har de aldrig været registreret korrekt. Du kan melde dem ud manuelt via siden her:
                <a href="https://sites.google.com/site/swcmedlemoghylder/medlemmer/indmeldte" target="_blank">medlemmer</a>
                <p>
                Når du er færdig kan du evt. flytte deres <a target="_blank" href="https://mail.google.com/mail/u/0/#label/SWC+Admin%2FUdmeldelser">udmeldelses mails</a> over i <a href="https://mail.google.com/mail/u/0/#label/SWC+Admin%2FUdmeldelser%2FProcesseret" target="_blank">/processeret</a> folderen. På den måde forsvinder de fra listen her.
             
                </p>
                </div>
          </section>
          
          <div>Har fundet følgende mails i folderen <strong><?= data.mailLabel ?></strong> som har angivet at de ønsker udmeldelser</div>
          
          
          <div><button data-bind="click: bulkUdmeld">Klik her</button> hvis du ønsker at markere dem alle som udmeldt.</div>
          
          <ul>  
          <? for (var i = 0; i < data.listOfMails.length; i++) { ?>
               <li><?= data.listOfMails[i].name ?> - <?= data.listOfMails[i].email ?> </li>
          <? } ?>
          </ul>
      <? } ?>
  
  
  </section>
 
  
  
  
  
  <?!= include('style'); ?>
  <?!= include('PageViewModel'); ?>
  <script>
  $(function(){
  var allEmails = [];
  <? for (var i = 0; i < data.listOfMails.length; i++) { ?> 
  allEmails.push(<?= data.listOfMails[i].email ?>);
  <? } ?>
  ko.applyBindings(new PageViewModel(allEmails));
  });
  </script>
  <? } ?>
  </body>
  
</html>


